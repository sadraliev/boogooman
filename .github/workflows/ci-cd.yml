name: CI/CD Pipeline

env: 
  IMAGE_TAG: boogooman

on:
  push:
    branches:
      - main

jobs:
  pipeline:
    runs-on: ubuntu-latest

    steps: 
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Print message after Checkout
      run: echo "Step 1 completed  - Checked out code"
  
    - name: Log in to Docker Hub 
      run: |
        docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_TOKEN }}
        echo "Step 2 completed - logged to DockerHub"
    - name: Build and Post image 
      run: | 
        docker build . --file Dockerfile --tag ${{ secrets.DOCKER_USERNAME }}/$IMAGE_TAG
        echo "Step 3 completed - built a new image"
        docker push ${{ secrets.DOCKER_USERNAME }}/$IMAGE_TAG 
        echo "Step 4 completed - pushed to DockerHub"